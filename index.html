<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>图片合成工具 (本地版)</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
        .input-group { margin-bottom: 15px; }
        canvas { border: 1px solid #ccc; max-width: 100%; height: auto; margin-top: 20px; }
        .download-btn { display: none; background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2>证件样式合成工具</h2>
    <p><small>*所有操作均在本地浏览器完成，您的隐私数据不会上传至服务器。</small></p>
    
    <div class="input-group">
        <label>1. 上传头像：</label>
        <input type="file" id="avatarInput" accept="image/*">
    </div>
    <div class="input-group">
        <label>2. 填写姓名：</label>
        <input type="text" id="nameInput" placeholder="输入姓名">
    </div>
    
    <button onclick="draw()">生成预览</button>
    <button id="downloadBtn" class="download-btn" onclick="downloadImg()">下载生成的图片</button>
    
    <br>
    <canvas id="canvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // 设置画布大小（根据你底图的比例）
    canvas.width = 1000;
    canvas.height = 1400;

    function draw() {
        // 1. 绘制背景颜色或底图
        ctx.fillStyle = "#FFCC33"; // 示例背景色
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // 2. 绘制文字信息
        ctx.fillStyle = "black";
        ctx.font = "bold 30px Arial";
        const name = document.getElementById('nameInput').value || "姓名示例";
        ctx.fillText(name, 450, 100);

        // 3. 处理本地上传图片
        const file = document.getElementById('avatarInput').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // 在指定位置绘制头像 (x, y, width, height)
                    ctx.drawImage(img, 50, 50, 200, 250);
                    finishDrawing();
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        } else {
            finishDrawing();
        }
    }

    function finishDrawing() {
        document.getElementById('downloadBtn').style.display = 'inline-block';
    }

    function downloadImg() {
        const link = document.createElement('a');
        link.download = 'generated-image.png';
        link.href = canvas.toDataURL();
        link.click();
    }
</script>

</body>
</html>
